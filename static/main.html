<!DOCTYPE html>
<html>
<head>
  <link href="../css/bootstrap.min.css" rel="stylesheet" media="screen"/>
  <link href="../css/main.css" rel="stylesheet" type="text/css"/>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular.min.js"></script>
  <script src="angular-route.min.js"></script>
  <meta charset="utf-8"/>
</head>

<body ng-app="myApp">
  <div ng-view>
  </div>

  <script>
    var module = angular.module("myApp", ['ngRoute']);
    module.config(['$routeProvider', function($routeProvider) {
        $routeProvider.
          when('/routeMain',{
            templateUrl: 'searchMain.html',
            controller: 'searchMainCtrl'
          }).
          when('/routeSearchPop',{
            templateUrl: 'searchPop.html',
            controller: 'searchPopCtrl'
          }).
          when('/routeSearchItemList',{
            templateUrl: 'searchItemList.html',
            controller: 'searchItemCtrl'
          }).
          otherwise({
            redirectTo: '/routeMain'
          });
      }]);

      module.factory('shareData', function($http){
        var factory = {};

        factory.keyWords;
        factory.items;
        return factory;
      });



      module.controller("searchMainCtrl", function($scope, shareData, $http, $sce, $location){
        $scope.searchMain = function(){
          var e1 = document.getElementById("selectYear");
          var year = e1.options[e1.selectedIndex].value;

          var e2 = document.getElementById("selectCommitee");
          var commitee = e2.options[e2.selectedIndex].value;

          var searchKey = $scope.search;
          shareData.keyWords = $scope.search;
          var url = "https://congress.api.sunlightfoundation.com/bills/search?query=" + shareData.keyWords;
          console.log(url);
          url = $sce.trustAsResourceUrl(url);

          $http.jsonp(url, {jsonpCallbackParam: 'callback'}).then(function(response) {

            shareData.items = response.data.results;
            console.log(response);
            $location.path( "/routeSearchItemList" );
          }).catch(function(err) {
            console.log(err);
          });

        }
      });

      module.controller("searchPopCtrl", function($scope, shareData){
        $scope.keyWordss = ["1", "2", "3", "4", "5","6","7","8","9","10","11","12","13","14","14","15","16",
                            "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28"];
        $scope.words1 = $scope.keyWordss.slice(0, 6);
        $scope.words2 = $scope.keyWordss.slice(6, 14);
        $scope.words3 = $scope.keyWordss.slice(14, 22);
        $scope.words4 = $scope.keyWordss.slice(22, 28);
      });

      module.controller("searchItemCtrl", function($scope, shareData){
        console.log(shareData.items);
        $scope.items = shareData.items;
      });

  </script>

</body>
</html>
